-- Servi√ßos essenciais
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Player = Players.LocalPlayer

-- Configura√ß√£o da UI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AutoParryUI"
screenGui.Parent = Player:WaitForChild("PlayerGui")

local statusFrame = Instance.new("Frame")
statusFrame.Size = UDim2.new(0.25, 0, 0.07, 0)
statusFrame.Position = UDim2.new(0.05, 0, 0.9, 0)
statusFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
statusFrame.BackgroundTransparency = 0.5
statusFrame.BorderSizePixel = 0
statusFrame.Parent = screenGui

local statusLabel = Instance.new("TextLabel")
statusLabel.Text = "üîç INICIANDO SISTEMA..."
statusLabel.Size = UDim2.new(1, 0, 1, 0)
statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
statusLabel.BackgroundTransparency = 1
statusLabel.Font = Enum.Font.GothamBold
statusLabel.TextSize = 14
statusLabel.Parent = statusFrame

-- Verifica√ß√£o INFAL√çVEL do jogador atual
local function GetMyCharacter()
    while not Player.Character do
        Player.CharacterAdded:Wait()
    end
    
    local character = Player.Character
    -- Verifica√ß√£o por CreatorTag (100% garantido)
    for _, child in ipairs(character:GetDescendants()) do
        if child:IsA("BasePart") and child:FindFirstChild("Creator") then
            if child.Creator.Value == Player then
                return character
            end
        end
    end
    
    -- Fallback seguro
    if character:FindFirstChild("Humanoid") then
        return character
    end
    
    return nil
end

-- Detec√ß√£o precisa da bola
local function GetDeathBall()
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") and obj.Name == "Part" then
            if obj:FindFirstChild("DeflectParticles") then
                return obj
            end
        end
    end
    return nil
end

-- Sistema principal de parry
RunService.Heartbeat:Connect(function()
    -- Obten√ß√£o garantida do personagem
    local character = GetMyCharacter()
    if not character then
        statusLabel.Text = "‚ùå PERSONAGEM N√ÉO ENCONTRADO"
        return
    end
    
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    
    -- Detec√ß√£o da bola
    local ball = GetDeathBall()
    if not ball then
        statusLabel.Text = "üîç PROCURANDO BOLA..."
        return
    end
    
    -- C√°lculo de dist√¢ncia REAL
    local distance = (hrp.Position - ball.Position).Magnitude
    statusLabel.Text = string.format("üéØ DIST√ÇNCIA: %.1f studs", distance)
    
    -- Verifica√ß√£o de dire√ß√£o e velocidade
    local ballVelocity = ball.AssemblyLinearVelocity
    local directionToMe = (hrp.Position - ball.Position).Unit
    local isApproaching = (ballVelocity.Unit:Dot(directionToMe) > 0.9)
    
    -- Condi√ß√£o de parry INFAL√çVEL
    if distance < 20 and isApproaching and ballVelocity.Magnitude > 30 then
        -- Sistema de click garantido
        for _ = 1, 3 do  -- Triple click para garantir
            mouse1press()
            wait(0.02)
            mouse1release()
            wait(0.02)
        end
        
        statusLabel.Text = "‚ö° PARRY EXECUTADO!"
        task.delay(0.3, function()
            statusLabel.Text = string.format("üü¢ PRONTO (Dist: %.1f)", distance)
        end)
    end
end)

-- Toggle com F10
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.F10 then
        screenGui.Enabled = not screenGui.Enabled
    end
end)

print("Sistema de AutoParry ativado com seguran√ßa m√°xima!")
